## ORM，ORM的原理及测试案例

## **一、什么是ORM。**

**概念：** 对象关系映射（Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。

**详细介绍：**  让我们从O/R开始。字母O起源于"对象"(Object),而R则来自于"关系"(Relational)。几乎所有的程序里面，都存在对象和关系数据库。在业务逻辑层和用户界面层中，我们是面向对象的。当对象信息发生变化的时候，我们需要把对象的信息保存在关系数据库中。 

​	当你开发一个应用程序的时候(不使用O/R Mapping),你可能会写不少数据访问层的代码，用来从数据库保存，删除，读取对象信息，等等。你在DAL中写了很多的方法来读取对象数据，改变状态对象等等任务。而这些代码写起来总是重复的。 

​	ORM解决的主要问题是对象关系的映射。域模型和关系模型分别是建立在概念模型的基础上的。域模型是面向对象的，而关系模型是面向关系的。一般情况下，一个持久化类和一个表对应，类的每个实例对应表中的一条记录，类的每个属性对应表的每个字段。 

​	ORM技术特点： 
​	1.提高了开发效率。由于ORM可以自动对Entity对象与数据库中的Table进行字段与属性的映射，所以我们实际可能已经不需要一个专用的、庞大的数据访问层。 
​        2.ORM提供了对数据库的映射，不用sql直接编码，能够像操作对象一样从数据库获取数据。



面向对象编程和关系型数据库，都是目前最流行的技术，但是它们的模型是不一样的。

面向对象编程把所有实体看成对象（object），关系型数据库则是采用实体之间的关系（relation）连接数据。很早就有人提出，关系也可以用对象表达，这样的话，就能使用面向对象编程，来操作关系型数据库。

![img](D:\java\md_pictures\JavaWeb\ORM.png)

**简单说，ORM 就是通过实例对象的语法，完成关系型数据库的操作的技术，是"对象-关系映射"（Object/Relational Mapping） 的缩写。**

ORM 把数据库映射成对象。

``` sql
数据库的表（table） --> 类（class）
记录（record，行数据）--> 对象（object）
字段（field）--> 对象的属性（attribute）
```

![img](D:\java\md_pictures\JavaWeb\ORM2.png)

​	举例来说，下面是一行 SQL 语句。

``` sql
SELECT id, first_name, last_name, phone, birth_date, sex
 FROM persons 
 WHERE id = 10
```

程序直接运行 SQL，操作数据库的写法如下。

``` java
res = db.execSql(sql);
name = res[0]["FIRST_NAME"];
```

改成 ORM 的写法如下。

``` java
p = Person.get(10);
name = p.first_name;
```

一比较就可以发现，ORM 使用对象，封装了数据库操作，因此可以不碰 SQL 语言。开发者只使用面向对象编程，与数据对象直接交互，不用关心底层数据库。



## **二、反射以及Attribute在ORM中的应用。**

**什么是反射？**
简单点吧，反射就是在运行时动态获取对象信息的方法，比如运行时知道对象有哪些属性，方法，委托等等等等。

**反射有什么用呢？**
反射不但让你在运行是获取对象的信息，还提供运行时动态调用对象方法以及动态设置、获取属性等的能力。

**反射在ORM中有什么用呢？**
这里所讨论的ORM实现是通过自定义Attribute的方式进行映射规则的描述的。但是我们并不知道具体哪个对象需要对应哪个表，并且这些对象是独立于 我们的ORM框架的，所以我们只能通过自定义Attribute来定义映射规则，然后通过反射来动态获取这些映射规则。



## 三、ORM的优缺点

1. 优点：
   orm的技术特点，提高了开发效率。可以自动对实体Entity对象与数据库中的Table进行字段与属性的映射；不用直接SQL编码，能够像操作对象一样从数据库中获取数据
   - 数据模型都在一个地方定义，更容易更新和维护，也利于重用代码。
   - ORM 有现成的工具，很多功能都可以自动完成，比如数据消毒、预处理、事务等等。
   - 它迫使你使用 MVC 架构，ORM 就是天然的 Model，最终使代码更清晰。
   - 基于 ORM 的业务代码比较简单，代码量少，语义性好，容易理解。
   - 你不必编写性能不佳的 SQL。
2. 缺点：
   orm会牺牲程序的执行效率和会固定思维模式，在从系统结构上来看，采用orm的系统多是多层系统的，系统的层次太多，效率就会降低，orm是一种完全面向对象的做法，所以面向对象的做法也会对性能产生一定的影响。
   - ORM 库不是轻量级工具，需要花很多精力学习和设置。
   - 对于复杂的查询，ORM 要么是无法表达，要么是性能不如原生的 SQL。
   - ORM 抽象掉了数据库层，开发者无法了解底层的数据库操作，也无法定制一些特殊的 SQL。

